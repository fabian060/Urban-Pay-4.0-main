import{k as w,B as h}from"./endpoints.A-j0qYyd.js";import{c as u}from"./notificiation.DyHDLNjw.js";document.querySelector("#payments-container");const p=document.querySelector("#payments-list"),S=document.querySelector("#payment-item-template"),m=document.querySelector("#loading"),y=document.querySelector("#error"),f=document.querySelector("#empty");async function i(){try{let r=function(e){const t=S.content.cloneNode(!0).children[0];t.querySelector(".payment-id").textContent=e.id,t.querySelector(".user-house-number").textContent=e.house_number,t.querySelector(".payment-date").textContent=new Date(e.date).toLocaleDateString(),t.querySelector(".payment-reference").textContent=e.payment_reference,t.querySelector("span.my-1").textContent=e.monto?Number(e.monto).toFixed(2):"0.00";const c=t.querySelector(".btn-accept"),d=t.querySelector(".btn-reject"),l=e.status==="accepted"||e.status==="rejected";c.disabled=l,d.disabled=l,l||(c.addEventListener("click",()=>g(e.id,"accepted")),d.addEventListener("click",()=>g(e.id,"rejected")));const a=t.querySelector(".status");return a.classList.remove("pending","accepted","rejected","bg-yellow-100","text-yellow-800"),e.status==="accepted"?(a.classList.add("accepted"),a.textContent="Aceptado"):e.status==="rejected"?(a.classList.add("rejected"),a.textContent="Rechazado"):(a.classList.add("pending","bg-yellow-100","text-yellow-800"),a.textContent="Pendiente"),t};m.classList.remove("hidden"),y.classList.add("hidden"),f.classList.add("hidden");const n=await w.get(`${h}/api/payment`,{credentials:"include"}).json();if(p.innerHTML="",n.length===0){f.classList.remove("hidden");return}let o=window.tipoFiltroPagos||"por-revisar",s=[];o==="todos"?s=n:o==="por-revisar"?s=n.filter(e=>e.status==="pending"):s=n.filter(e=>["accepted","rejected"].includes(e.status)),o==="todos"?s.sort((e,t)=>{const c=e.status==="pending"?0:1,d=t.status==="pending"?0:1;return c!==d?c-d:new Date(e.date)-new Date(t.date)}):s.sort((e,t)=>new Date(e.date)-new Date(t.date));for(const e of s)p.appendChild(r(e))}catch(r){console.error("Error loading payments:",r),y.classList.remove("hidden"),(r.response?.status===401||r.response?.status===403)&&location.replace("/login")}finally{m.classList.add("hidden")}}async function g(r,n){try{const o=await w.patch(`${h}/api/payment/${r}/status`,{json:{status:n},credentials:"include"}).json();u({title:`Pago ${n==="accepted"?"aceptado":"rechazado"}`,type:"success"}),n==="accepted"&&o.cuota_id&&(cuotasPagadas.includes(o.cuota_id)||cuotasPagadas.push(o.cuota_id)),await i()}catch(o){console.error("Error updating payment status:",o);const s=await o.response?.json();u({title:"Error al procesar la acciÃ³n",description:s?.error||"Error desconocido",type:"error"})}}document.getElementById("btn-todos").onclick=()=>{window.tipoFiltroPagos="todos",i()};document.getElementById("btn-por-revisar").onclick=()=>{window.tipoFiltroPagos="por-revisar",i()};document.getElementById("btn-revisado").onclick=()=>{window.tipoFiltroPagos="revisado",i()};i();
