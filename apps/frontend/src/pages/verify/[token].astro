---
import Layout from "../../layouts/layouts.astro";
export const prerender = false
---

<Layout title="App">
  <main class="h-[calc(100vh-4rem)] flex flex-col gap-8 p-4 max-w-[90rem] mx-auto md:items-center justify-center">
    <div class="border-1 p-4 rounded-md">
      <p id="verify-text" class="text-center">Verificando el correo</p>
    </div>
  </main>
</Layout>

<script>
  // @ts-nocheck
  import ky from 'ky';
  import {BACK_ENDPOINT} from '../../config/endpoints.js';
  const token = window.location.pathname.split('/verify/')[1];
  const verifyText = document.querySelector('#verify-text');
  try {
    const data = await ky.patch(`${BACK_ENDPOINT}/api/users/verify`, {json: {token}}).json();
    verifyText.innerHTML = data.message;
    setTimeout(() => {
      window.location.replace('/login');
    }, 3000);
  } catch (error) {
    console.error(error);
    // Si `error.response` existe, es un error del backend (ej: 400, 401).
    // Si no, es un error de red (ej: backend caído o URL incorrecta como 'localhost').
    const errorData = error.response
      ? await error.response.json()
      : { error: 'Error de conexión: No se pudo contactar al servidor.' };
    verifyText.innerHTML = errorData.error || 'Ocurrió un error inesperado.';
  }
</script>