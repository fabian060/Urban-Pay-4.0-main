<!DOCTYPE html><html lang="en" data-astro-cid-dvz75727> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.17.1"><title>Reportar Pago</title><link rel="stylesheet" href="/_astro/account_statement.CvkI6C00.css"></head> <body class="pt-16" data-astro-cid-dvz75727> <div id="notification" class="fixed p-4 top-4 right-4 rounded-2xl z-[60] hidden"> <p id="notification-title" class="font-bold text-lg">Error</p> <p id="notification-description">Hubo un error obteniendo las cuotas</p> </div> <!-- TODO: Menu movil --><nav class="bg-[#2563EB] text-white fixed top-0 left-0 right-0 z-50"> <div class="max-w-7xl mx-auto h-16 flex items-center justify-between"> <div class="flex items-center gap-2 h-full"> <!-- <img class="w-8 h-8" src={logoPng.src} alt="logo"> --> <h2 class="font-medium text-xl">Urb. Country Club Buenaventura</h2> </div> <div class="flex items-center gap-4"> <a id="nav-home-link" href="/" class="font-medium hover:underline">Inicio</a> </div> </div> </nav> <script type="module">const e=document.getElementById("nav-home-link");e&&fetch("/api/auth/user",{credentials:"include"}).then(n=>{n.ok&&(e.style.display="none")}).catch(()=>{});</script>  <div id="auth-div"> <div id="loading-text" class="flex flex-row gap-2 h-screen w-full justify-center items-center"> <div class="w-4 h-4 rounded-full bg-[#2563EB] animate-bounce [animation-delay:.7s]"></div> <div class="w-4 h-4 rounded-full bg-[#2563EB] animate-bounce [animation-delay:.3s]"></div> <div class="w-4 h-4 rounded-full bg-[#2563EB] animate-bounce [animation-delay:.7s]"></div> </div> <div id="auth-content" class="hidden">  <div class="flex"> <html lang="es"> <body class="bg-gray-100"> <nav class="fixed top-16 left-0 h-[calc(100vh-4rem)] w-45 bg-[#2563EB] text-white z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 sidebar"> <div class="flex flex-col h-full"> <h2 id="user-greeting" class="px-6 py-4 font-medium text-xl border-b border-blue-700"></h2> <ul class="flex-1 px-6 py-4 space-y-4"> <li><a class="block no-underline hover:underline" href="/inicio">Inicio</a></li> <li> <button id="usuario-toggle" class="w-full text-left block no-underline hover:underline font-semibold">Usuario ▼</button> <ul id="usuario-submenu" class="pl-4 mt-2 space-y-2 hidden"> <li><a class="block no-underline hover:underline" href="/account_statement">Estado de Cuenta</a></li> <li><a class="block no-underline hover:underline" href="/payment">Reportar Pago</a></li> </ul> </li> <li id="admin-section"> <button id="admin-toggle" class="w-full text-left block no-underline hover:underline font-semibold">Administrador ▼</button> <ul id="admin-submenu" class="pl-4 mt-2 space-y-2 hidden"> <li><a class="block no-underline hover:underline" href="/cuotas_status">Reportes</a></li> <li><a class="block no-underline hover:underline" href="/search">Buscar Usuario</a></li> <li><a class="block no-underline hover:underline" href="/cuotas">Agregar Cuota</a></li> </ul> </li> <li> <button id="logout-button" class="w-full text-left block no-underline hover:underline">Salir</button> </li> </ul> </div> </nav> <button class="fixed top-4 left-4 z-60 p-2 rounded-md bg-white text-blue-600 shadow-md sidebar-toggle lg:hidden" aria-label="Abrir menú"> <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path> </svg> </button> <script>
      if (typeof window !== 'undefined') {
        // Definimos la lógica como una función asíncrona para poder usar 'await'
        const initializeSidebar = async () => {
          const sidebar = document.querySelector('.sidebar');
          const toggle = document.querySelector('.sidebar-toggle');
          if (sidebar && toggle) {
            toggle.addEventListener('click', () => {
              sidebar.classList.toggle('-translate-x-full');
              sidebar.classList.toggle('translate-x-0');
            });
          }

          // Lógica para mostrar/ocultar el menú de administrador
          const adminSection = document.getElementById('admin-section');
          const greetingElement = document.getElementById('user-greeting');
          
          try {
            // El navegador envía automáticamente la cookie httpOnly con esta petición
            const response = await fetch('/api/auth/user', {
              credentials: 'include', // Envía las cookies incluso en peticiones cross-origin
            });
            
            if (response.ok) {
              const user = await response.json();
              // DEBUG: Muestra el usuario obtenido del backend
              console.log('Usuario obtenido de /api/auth/user:', user);

              if (greetingElement && user.email) {
                const username = user.email.split('@')[0];
                greetingElement.textContent = `Bienvenido, ${username}`;
              }
              
              // Ocultar la sección si el usuario no es admin
              if (adminSection && !user.is_admin) {
                adminSection.style.display = 'none';
              }
            } else {
              // Si la petición falla (ej. 401 Unauthorized), el usuario no tiene sesión
              console.log('No hay sesión de usuario activa.');
              if (adminSection) {
                adminSection.style.display = 'none';
              }
            }
          } catch (error) {
            console.error('Error al obtener datos del usuario:', error);
            if (adminSection) {
              adminSection.style.display = 'none';
            }
          }
          
          // Submenú Usuario
          const usuarioToggle = document.getElementById('usuario-toggle');
          const usuarioSubmenu = document.getElementById('usuario-submenu');
          if (usuarioToggle && usuarioSubmenu) {
            usuarioToggle.addEventListener('click', () => {
              usuarioSubmenu.classList.toggle('hidden');
            });
          }
          
          // Submenú Administrador
          const adminToggle = document.getElementById('admin-toggle');
          const adminSubmenu = document.getElementById('admin-submenu');
          if (adminToggle && adminSubmenu) {
            adminToggle.addEventListener('click', () => {
              adminSubmenu.classList.toggle('hidden');
            });
          }

          // Lógica para el botón de logout
          const logoutButton = document.getElementById('logout-button');
          if (logoutButton) {
            logoutButton.addEventListener('click', async () => {
              await fetch('/api/auth/logout', { credentials: 'include' });
              // Redirigir al home después de cerrar sesión
              window.location.href = '/';
            });
          }
        };

        window.addEventListener('DOMContentLoaded', initializeSidebar);
      }
    </script> </body> </html> <main class="h-[calc(100vh-4rem)] flex flex-col md:flex-row gap-8 p-4 max-w-[90rem] mx-auto items-center justify-center"> <div class="w-full max-w-md p-2 md:px-8 space-y-3 bg-white dark:bg-gray-600/40 rounded-lg shadow-xl dark:shadow-gray-900"> <h1 class="text-2xl font-bold text-center text-gray-900 dark:text-white">Reportar pago</h1> <form id="signup-form" class="space-y-6" novalidate> <div> <label for="payment_method" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Tipo de pago</label> <select id="payment_method" name="payment_method" class="w-full px-4 py-2 text-gray-900 bg-gray-50 border rounded-lg focus:ring-blue-500 focus:outline-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-colors duration-200 cursor-pointer"> <option value="">Elige una opción</option> <option value="1">Pago Móvil</option> </select> <p id="payment-method-helper" class="mt-2 text-xs text-gray-500 dark:text-gray-400">
Selecciona el tipo de método de pago.
</p> </div> <div> <label for="verify-password" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Fecha</label> <input type="date" id="date" name="date" placeholder="fecha" class="w-full px-4 py-2 text-gray-900 bg-gray-50 border rounded-lg focus:ring-blue-500 focus:outline-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-colors duration-200 cursor-pointer
                "> <p id="email-helper" class="mt-2 text-xs text-gray-500 dark:text-gray-400">
La fecha en la realizaste el pago.
</p> </div> <div> <label for="verify-password" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Numero de referencia</label> <input type="text" id="payment_reference" name="payment_reference" placeholder="Numero de referencia" class="w-full px-4 py-2 text-gray-900 bg-gray-50 border rounded-lg focus:ring-blue-500 focus:outline-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-colors duration-200"> <p id="email-helper" class="mt-2 text-xs text-gray-500 dark:text-gray-400">
los ultimos cuatro numeros del numero de referencia.
</p> </div> <div> <label for="verify-password" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">Monto</label> <input type="number" id="monto" name="monto" placeholder="Monto" class="w-full px-4 py-2 text-gray-900 bg-gray-50 border rounded-lg focus:ring-blue-500 focus:outline-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white transition-colors duration-200"> <p id="email-helper" class="mt-2 text-xs text-gray-500 dark:text-gray-400">
Monto del pago realizado.
</p> </div> <button type="submit" id="submit-button" disabled class="w-full px-5 py-3 text-base font-medium text-center text-white bg-[#2563EB] rounded-lg hover:bg-[#4077ED]focus:ring-4 focus:ring-green-300 disabled:bg-gray-600 disabled:cursor-not-allowed dark:bg-[#2563EB] dark:hover:bg-[#4077ED] dark:focus:ring-blue-800 dark:disabled:bg-gray-600 transition-colors duration-200">
Reportar pago
</button> </form> </div> <div class="w-full max-w-md p-4 space-y-4 bg-white dark:bg-gray-600/40 rounded-lg shadow-xl dark:shadow-gray-400/20"> <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-2">DATOS</h2> <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">Pago movil</h3> <ul class="list-disc pl-5 text-gray-800 dark:text-gray-200 space-y-2"> <li>Banco: Venezuela</li> <li>Telefono: 0424-1989711</li> <li>CI: 31.448.916</li> </ul> <p class="text-sm text-gray-600 dark:text-gray-300">Realiza el pago usando los datos anteriores y reporta tu pago usando el formulario.</p> </div> </main> </div> </div> </div> <script type="module" src="/_astro/AuthProtected.astro_astro_type_script_index_0_lang.Hfj5zOBN.js"></script>  </body></html> <script type="module" src="/_astro/payment.astro_astro_type_script_index_0_lang.gSmY65aW.js"></script>