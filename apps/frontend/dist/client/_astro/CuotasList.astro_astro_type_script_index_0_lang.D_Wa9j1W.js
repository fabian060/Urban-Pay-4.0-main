import{k as h,B as m}from"./endpoints.A-j0qYyd.js";import{C as p,c as D}from"./cuotas.module.CEqowzwp.js";import{a as _}from"./index.CViUNx8d.js";import{c as y}from"./notificiation.DyHDLNjw.js";const g=_([]),v=async()=>{try{const o=await h.get(`${m}/api/payment`,{credentials:"include"}).json();g.set(o)}catch(o){console.error(o)}},b=document.querySelector("#cuotas-list"),C=document.querySelector("#cuotas-item-template");await p.getCuotas();const E=await h.get(`${m}/api/auth/user`,{credentials:"include"}).json(),I=await h.get(`${m}/api/users/search?house_number=${E.house_number}`,{credentials:"include"}).json(),L=new Set(I.map(o=>o.id));await v();D.subscribe(o=>{const u=g.get(),d=new Set,r=new Set;for(const t of u)L.has(t.user_id)&&(t.status==="accepted"&&d.add(t.cuota_id),t.status==="pending"&&r.add(t.cuota_id));b.innerHTML="";let e=[...o];e.sort((t,a)=>{const n=new Date(t.date);return new Date(a.date)-n});for(const t of e){const a=C.content.cloneNode(!0).children[0],n=a.children[0].children[0],i=a.children[0].children[1],l=a.children[0].children[2],c=a.children[0].children[3],f=t.date?t.date.split("T")[0]:t.date,w=t.date_limit?t.date_limit.split("T")[0]:t.date_limit;a.id=t.id,n.value=t.description,i.value=f,l.value=w,c.value=t.monto;const s=a.querySelector(".pay-btn");d.has(t.id)?(a.style.backgroundColor="#d1fae5",s&&(s.disabled=!0)):r.has(t.id)?(a.style.backgroundColor="#fff7ed",s&&(s.disabled=!0,s.title="Pago pendiente")):s&&(s.disabled=!1),b.append(a)}});b.addEventListener("click",async o=>{const u=o.target.closest(".delete-btn"),d=o.target.closest(".edit-btn");if(u){const e=u.parentElement.parentElement;await p.removeCuota(e.id)}if(d){const e=d.parentElement.parentElement,t=e.dataset.status,a=e.children[0].children[0],n=e.children[0].children[1],i=e.children[0].children[2],l=e.children[0].children[3],c=e.children[1].children[0];if(t==="inputs-deshabilitados"&&(a.removeAttribute("readonly"),n.removeAttribute("readonly"),i.removeAttribute("readonly"),l.removeAttribute("readonly"),e.dataset.status="inputs-habilitados",c.children[0].classList.add("hidden"),c.children[1].classList.remove("hidden")),t==="inputs-habilitados"){a.setAttribute("readonly",!0),n.setAttribute("readonly",!0),i.setAttribute("readonly",!0),l.setAttribute("readonly",!0),e.dataset.status="inputs-deshabilitados",c.children[0].classList.remove("hidden"),c.children[1].classList.add("hidden");const f={id:e.id,description:a.value,date:n.value,date_limit:i.value,monto:l.value};await p.updateCuota(f)}}const r=o.target.closest(".pay-btn");if(r){const e=r.parentElement.parentElement;if(r.disabled)return;const t=e.children[0].children[3].value,a={date:new Date().toISOString().split("T")[0],payment_reference:String(Math.floor(1e3+Math.random()*9e3)),payment_methods_id:"1",monto:t};try{await h.post(`${m}/api/payment`,{json:a,credentials:"include"}).json(),await v(),await p.getCuotas(),e.style.backgroundColor="#d1fae5";const n=e.querySelector(".pay-btn");n&&(n.disabled=!0),y({title:"Pago realizado",description:"Tu pago fue registrado y está pendiente de aprobación",type:"success"})}catch(n){console.error(n);try{const i=await n.response.json();y({title:"Error al pagar",description:i.error||"Hubo un error",type:"error"})}catch{y({title:"Error al pagar",description:"Hubo un error",type:"error"})}}}});
