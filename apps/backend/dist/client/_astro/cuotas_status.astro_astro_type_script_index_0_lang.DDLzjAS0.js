import{k as w,B as h}from"./endpoints.JZqDPgRs.js";import{c as u}from"./notificiation.C3UD7vwj.js";document.querySelector("#payments-container");const p=document.querySelector("#payments-list"),S=document.querySelector("#payment-item-template"),m=document.querySelector("#loading"),y=document.querySelector("#error"),f=document.querySelector("#empty");async function d(){try{let n=function(e){const t=S.content.cloneNode(!0).children[0];t.querySelector(".payment-id").textContent=e.id,t.querySelector(".user-house-number").textContent=e.house_number,t.querySelector(".payment-date").textContent=new Date(e.date).toLocaleDateString(),t.querySelector(".payment-reference").textContent=e.payment_reference,t.querySelector("span.my-1").textContent=e.monto?Number(e.monto).toFixed(2):"0.00";const a=t.querySelector(".btn-accept"),i=t.querySelector(".btn-reject"),l=e.status==="accepted"||e.status==="rejected";a.disabled=l,i.disabled=l,l||(a.addEventListener("click",()=>g(e.id,"accepted")),i.addEventListener("click",()=>g(e.id,"rejected")));const c=t.querySelector(".status");return c.classList.remove("pending","accepted","rejected","bg-yellow-100","text-yellow-800"),e.status==="accepted"?(c.classList.add("accepted"),c.textContent="Aceptado"):e.status==="rejected"?(c.classList.add("rejected"),c.textContent="Rechazado"):(c.classList.add("pending","bg-yellow-100","text-yellow-800"),c.textContent="Pendiente"),t};m.classList.remove("hidden"),y.classList.add("hidden"),f.classList.add("hidden");const s=await w.get(`${h}/api/payment`,{credentials:"include"}).json();if(p.innerHTML="",s.length===0){f.classList.remove("hidden");return}let r=window.tipoFiltroPagos||"por-revisar",o=[];r==="todos"?o=s:r==="por-revisar"?o=s.filter(e=>e.status==="pending"):o=s.filter(e=>["accepted","rejected"].includes(e.status)),r==="todos"?o.sort((e,t)=>{const a=e.status==="pending"?0:1,i=t.status==="pending"?0:1;return a!==i?a-i:new Date(e.date)-new Date(t.date)}):o.sort((e,t)=>new Date(e.date)-new Date(t.date));for(const e of o)p.appendChild(n(e))}catch(n){console.error("Error loading payments:",n),y.classList.remove("hidden"),(n.response?.status===401||n.response?.status===403)&&location.replace("/login")}finally{m.classList.add("hidden")}}async function g(n,s){try{const r=await w.patch(`${h}/api/payment/${n}/status`,{json:{status:s},credentials:"include"}).json();u({title:`Pago ${s==="accepted"?"aceptado":"rechazado"}`,type:"success"}),await d()}catch(r){console.error("Error updating payment status:",r);const o=await r.response?.json();u({title:"Error al procesar la acciÃ³n",description:o?.error||"Error desconocido",type:"error"})}}document.getElementById("btn-todos").onclick=()=>{window.tipoFiltroPagos="todos",d()};document.getElementById("btn-por-revisar").onclick=()=>{window.tipoFiltroPagos="por-revisar",d()};document.getElementById("btn-revisado").onclick=()=>{window.tipoFiltroPagos="revisado",d()};d();
