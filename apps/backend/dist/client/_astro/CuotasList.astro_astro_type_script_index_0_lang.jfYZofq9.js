import{k as d,B as l}from"./endpoints.JZqDPgRs.js";import{C as p,c as _}from"./cuotas.module.Aks6tYO2.js";import{a as C}from"./index.CViUNx8d.js";import{c as u}from"./notificiation.C3UD7vwj.js";const h=C([]),y=async()=>{try{const a=await d.get(`${l}/api/payment`,{credentials:"include"}).json();h.set(a)}catch(a){console.error(a)}},m=document.querySelector("#cuotas-list"),S=document.querySelector("#cuotas-item-template");await p.getCuotas();const B=await d.get(`${l}/api/auth/user`,{credentials:"include"}).json(),E=await d.get(`${l}/api/users/search?house_number=${B.house_number}`,{credentials:"include"}).json(),v=new Set(E.map(a=>a.id));await y();_.subscribe(a=>{const i=h.get(),r=new Set,o=new Set;for(const t of i)v.has(t.user_id)&&(t.status==="accepted"&&r.add(t.cuota_id),t.status==="pending"&&o.add(t.cuota_id));m.innerHTML="";let c=[...a];c.sort((t,e)=>{const s=new Date(t.date);return new Date(e.date)-s});for(const t of c){const e=S.content.cloneNode(!0).children[0],s=e.children[0].children[0],f=e.children[0].children[1],g=e.children[0].children[2],b=e.children[0].children[3],w=t.date?t.date.split("T")[0]:t.date,D=t.date_limit?t.date_limit.split("T")[0]:t.date_limit;e.id=t.id,s.value=t.description,f.value=w,g.value=D,b.value=t.monto;const n=e.querySelector(".pay-btn");r.has(t.id)?(e.style.backgroundColor="#d1fae5",n&&(n.disabled=!0)):o.has(t.id)?(e.style.backgroundColor="#fff7ed",n&&(n.disabled=!0,n.title="Pago pendiente")):n&&(n.disabled=!1),m.append(e)}});m.addEventListener("click",async a=>{const i=a.target.closest(".delete-btn");if(i){const o=i.parentElement.parentElement;await p.removeCuota(o.id)}const r=a.target.closest(".pay-btn");if(r){const o=r.parentElement.parentElement;if(r.disabled)return;const c=o.children[0].children[3].value,t={date:new Date().toISOString().split("T")[0],payment_reference:String(Math.floor(1e3+Math.random()*9e3)),payment_methods_id:"1",monto:c};try{await d.post(`${l}/api/payment`,{json:t,credentials:"include"}).json(),await y(),await p.getCuotas(),o.style.backgroundColor="#d1fae5";const e=o.querySelector(".pay-btn");e&&(e.disabled=!0),u({title:"Pago realizado",description:"Tu pago fue registrado y está pendiente de aprobación",type:"success"})}catch(e){console.error(e);try{const s=await e.response.json();u({title:"Error al pagar",description:s.error||"Hubo un error",type:"error"})}catch{u({title:"Error al pagar",description:"Hubo un error",type:"error"})}}}});
